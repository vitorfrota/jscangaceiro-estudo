{"version":3,"sources":["../../../app-src/domain/negociacao/NegociacaoDao.js"],"names":["Negociacao","NegociacaoDao","constructor","connection","_connection","_store","adiciona","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","_","onerror","e","console","log","target","error","apagaTodos","clear","listaTodos","negociacoes","cursor","openCursor","atual","result","value","_data","_quantidade","_valor","push","continue"],"mappings":";;;;;;AAASA,sB,iBAAAA,U;;;gBAEIC,a,GAAN,MAAMA,aAAN,CAAoB;AACvBC,4BAAYC,UAAZ,EAAuB;AACnB,yBAAKC,WAAL,GAAmBD,UAAnB;AACA,yBAAKE,MAAL,GAAc,aAAd;AACH;;AAEDC,yBAASC,UAAT,EAAoB;AAChB,2BAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAoB;AACnC,8BAAMC,UAAU,KAAKP,WAAL,CACfQ,WADe,CACH,CAAC,KAAKP,MAAN,CADG,EACY,WADZ,EAEfQ,WAFe,CAEH,KAAKR,MAFF,EAGfS,GAHe,CAGXP,UAHW,CAAhB;;AAKAI,gCAAQI,SAAR,GAAoBC,KAAKP,SAAzB;;AAEAE,gCAAQM,OAAR,GAAkBC,KAAK;AACnBC,oCAAQC,GAAR,CAAYF,EAAEG,MAAF,CAASC,KAArB;;AAEAZ,mCAAO,sCAAP;AACH,yBAJD;AAKH,qBAbM,CAAP;AAcH;;AAEDa,6BAAY;AACR,2BAAO,IAAIf,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAoB;AACnC,8BAAMC,UAAU,KAAKP,WAAL,CACfQ,WADe,CACH,CAAC,KAAKP,MAAN,CADG,EACY,WADZ,EAEfQ,WAFe,CAEH,KAAKR,MAFF,EAGfmB,KAHe,EAAhB;;AAKAb,gCAAQI,SAAR,GAAoBG,KAAKT,SAAzB;;AAEAE,gCAAQM,OAAR,GAAkBC,KAAK;AACnBC,oCAAQC,GAAR,CAAYF,EAAEG,MAAF,CAASC,KAArB;;AAEAZ,mCAAO,sCAAP;AACH,yBAJD;AAKH,qBAbM,CAAP;AAcH;;AAEDe,6BAAY;AACR,2BAAO,IAAIjB,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAoB;AACnC,8BAAMgB,cAAc,EAApB;;AAEA,8BAAMC,SAAS,KAAKvB,WAAL,CACdQ,WADc,CACF,CAAC,KAAKP,MAAN,CADE,EACa,WADb,EAEdQ,WAFc,CAEF,KAAKR,MAFH,EAGduB,UAHc,EAAf;;AAKAD,+BAAOZ,SAAP,GAAmBG,KAAK;AACpB,kCAAMW,QAAQX,EAAEG,MAAF,CAASS,MAAvB;;AAEA,gCAAGD,KAAH,EAAS;AACL,sCAAMtB,aAAa,IAAIP,UAAJ,CACf6B,MAAME,KAAN,CAAYC,KADG,EAEfH,MAAME,KAAN,CAAYE,WAFG,EAGfJ,MAAME,KAAN,CAAYG,MAHG,CAAnB;;AAKIR,4CAAYS,IAAZ,CAAiB5B,UAAjB;;AAEAsB,sCAAMO,QAAN;AACP,6BATD,MASO;AACH3B,wCAAQiB,WAAR;AACH;;AAEDC,mCAAOV,OAAP,GAAiBC,KAAK;AAClBC,wCAAQC,GAAR,CAAYF,EAAEG,MAAF,CAASC,KAArB;;AAEAZ,uCAAO,yCAAP;AACH,6BAJD;AAKH,yBArBD;AAsBH,qBA9BM,CAAP;AA+BH;AAxEsB,a","file":"NegociacaoDao.js","sourcesContent":["import { Negociacao } from './Negociacao.js';\r\n\r\nexport class NegociacaoDao {\r\n    constructor(connection){\r\n        this._connection = connection;\r\n        this._store = 'negociacoes';\r\n    }\r\n\r\n    adiciona(negociacao){\r\n        return new Promise((resolve, reject)=> {\r\n            const request = this._connection\r\n            .transaction([this._store], 'readwrite')\r\n            .objectStore(this._store)\r\n            .add(negociacao);\r\n\r\n            request.onsuccess = _ => resolve();\r\n\r\n            request.onerror = e => {\r\n                console.log(e.target.error);\r\n\r\n                reject('Não foi possível salvar a negociação');\r\n            }\r\n        });\r\n    }\r\n\r\n    apagaTodos(){\r\n        return new Promise((resolve, reject)=> {\r\n            const request = this._connection\r\n            .transaction([this._store], 'readwrite')\r\n            .objectStore(this._store)\r\n            .clear();\r\n\r\n            request.onsuccess = e => resolve();\r\n\r\n            request.onerror = e => {\r\n                console.log(e.target.error);\r\n\r\n                reject('Não foi possível salvar a negociação');\r\n            }\r\n        });\r\n    }\r\n\r\n    listaTodos(){\r\n        return new Promise((resolve, reject)=> {\r\n            const negociacoes = [];\r\n\r\n            const cursor = this._connection\r\n            .transaction([this._store], 'readwrite')\r\n            .objectStore(this._store)\r\n            .openCursor();\r\n\r\n            cursor.onsuccess = e => {\r\n                const atual = e.target.result;\r\n\r\n                if(atual){\r\n                    const negociacao = new Negociacao(\r\n                        atual.value._data,\r\n                        atual.value._quantidade,\r\n                        atual.value._valor);\r\n                    \r\n                        negociacoes.push(negociacao);\r\n\r\n                        atual.continue();\r\n                } else {\r\n                    resolve(negociacoes);\r\n                }\r\n\r\n                cursor.onerror = e => {\r\n                    console.log(e.target.error);\r\n                    \r\n                    reject('Não foi possível listar nas negociações');\r\n                }\r\n            }\r\n        });\r\n    }\r\n}"]}